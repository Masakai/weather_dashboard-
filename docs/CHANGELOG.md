Changelog

本プロジェクトの全ての重要な変更はこのファイルに記録されます。

このプロジェクトは Semantic Versioning (SemVer) に従います。
バージョン番号の形式は MAJOR.MINOR.PATCH です。

MAJOR: 互換性のないAPI変更がある場合

MINOR: 後方互換性のある機能追加がある場合

PATCH: 後方互換性のあるバグ修正や軽微なスタイル変更の場合

[3.1.5] - 2026-01-17

Fixed

- ISSリアルタイム星座図の更新不具合を修正:
    - ダッシュボードで特定の日時を選択している場合でも、リアルタイム星座図を表示した際は常に「現在」のISS位置と空の状態を表示・更新し続けるように改善。
    - リアルタイムモードの状態管理を導入し、パス予測表示との切り替えをより確実にしました。

[3.1.4] - 2026-01-17

Added

- ISSリアルタイム更新画面において、ISSが地平線下にある場合に、次に可視範囲に入るまでのカウントダウンを表示する機能を追加。

[3.1.3] - 2026-01-17

Fixed

- iss-service.js の安定性向上:
    - TLEデータの取得（fetch）に5秒のタイムアウトを追加し、通信の停滞による「計算中」表示の固まりを防止。
    - ISSパス計算処理を非同期のチャンク処理（setTimeout 0）に変更し、ブラウザのメインスレッドのブロックを防止。
    - 計算開始フラグの管理を改善し、重複実行を防止。
    - 例外発生時にUIをエラー表示に更新するように改善。
- キャッシュ対策の強化: 全サービスモジュールのインポートにバージョンクエリパラメータを追加し、リモート環境での最新コード反映を確実にしました。

[3.1.2] - 2026-01-17

Fixed

- ui-utils.js の修正: escapeHtml 関数に null/undefined ガードを追加。
- キャッシュ対策: index.html で読み込む main.js にバージョンパラメータを追加。

[3.1.1] - 2026-01-17

Fixed

- ui-utils.js の修正: escapeHtml 関数が値を返していなかったため、お気に入り地点の名前が undefined と表示される不具合を修正。

[3.1.0] - 2026-01-17

Fixed

- iss-service.js の修復: ファイル冒頭の構文エラーや不要なコードの混入、未完成だった関数の不整合を全面的に解消。
- astronomy-service.js の構文エラー修正: timelineDuration の重複宣言 (Cannot declare a const variable twice) を修正。
- 観測適性レーダーチャートの不具合修正: weather-service.js に renderRadarChart を新規実装し、データ取得時に発生していたエラーを解消。
- ダッシュボード描画の最適化: astronomy-service.js 内の不完全な renderDashboard 関数を削除し、weather-service.js の正当な関数が呼ばれるように調整。
- weather-service.js のバグ修正: updateStarryScore 内での未定義変数参照を修正。
- サービスモジュールの整合性向上: location-service.js や astronomy-service.js で発生していたコードの欠損や混入を修復。

[3.0.0] - 2026-01-17

Changed

大規模なリファクタリングの実施。

1. ES Modules (type="module") の導入と機能分割。
   3000行を超えていた functions.js を、その責務に応じて以下の5つのモジュールに分割し、保守性と拡張性を向上させました。
   - ui-utils.js: 共通のUI操作（アコーディオン、ナイトビジョン等）
   - location-service.js: 位置情報、地図、お気に入り管理
   - weather-service.js: 天気データの取得と描画
   - iss-service.js: ISSの軌道計算と通知
   - astronomy-service.js: 天体イベントの計算

2. グローバル変数の削減。
   バラバラだったグローバル変数を AppState オブジェクト (state.js) に集約し、定数データを constants.js に分離。

3. 互換性の維持。
   既存の HTML 内のイベントハンドラが動作するよう、main.js において各モジュールの関数を window オブジェクトにバインドするブリッジ処理を実装。

[2.14.0] - 2026-01-17

Improved

夜間観測タイムラインに雲量データを反映。
天文薄明の間の「観測適時」を雲量に基づいて4段階に色分け（緑：快晴、黄：薄曇、橙：曇り、赤：曇天）して表示するように改善。各セグメントに詳細なツールチップ（雲量・時間帯）を追加し、タイムライン下に凡例を追加することで視認性を向上。

[2.13.0] - 2026-01-17

Added

月齢による観測推奨天体に季節対応機能を追加。
春夏秋冬の季節ごとに最適な観測対象を表示するよう改善。新月期には季節の代表的な銀河・星雲・星団を推奨し、満月期や上弦・下弦期にも季節に応じた観測対象を提案。季節の表示を追加し、現在の季節と月齢状況を明確化。

[2.9.1] - 2026-01-16

Changed

ISSのTLE（2行軌道要素形式）の取得頻度を1日1回に制限。
localStorageを利用して軌道要素データをキャッシュすることで、不要なネットワークリクエストを削減し、安定性を向上。

[2.9.0] - 2026-01-16

Improved

天体観測予報のレイアウトを刷新。
時間帯別の予報を横並びのカード形式に変更し、記号の代わりに星空視認性スコアと同じアイコン（星、キラキラ、晴れ、曇り）を使用するように改善。

[2.8.1] - 2026-01-16

Added

星座図（星図）に太陽をプロットする機能を追加。
高度が0度以上の時に、オレンジ色のマーカーで太陽の位置が表示されるように改善。

[2.8.0] - 2026-01-16

Improved

ISS星座図の計算に使用する時刻の最適化。
現在位置を表示する場合は実時間（リアルタイム）を使用し、予測パスを表示する場合はそのパスの最大高度時刻を使用するように変更。
これにより、ISSの位置に合わせて月や惑星の位置も正確に表示されるように改善。

[2.7.0] - 2026-01-15

Added

Interaction: 週間予報テーブルの行をクリック可能にし、選択した日付の詳細データ（気温、雲量、月齢など）を上部ダッシュボードに反映する機能を追加。

UI: 週間予報テーブルにクリック操作に関する注釈を追加し、行のホバー効果（カーソル変更）を調整。

[1.5.0] - 2026-01-02

Changed

UI: アプリケーションタイトルを「天体観測できるかな？」に変更し、コンセプトを明確化。

UI: ヘッダーデザインを更新。望遠鏡アイコンを追加し、タイトルを大きく強調表示。

[1.4.0] - 2026-01-02

Added

Feature: 月齢（Moon Age）および月相（Moon Phase）の計算ロジックを追加。

UI: サマリーエリアに現在の月相アイコン、月齢、月相名（満月、新月など）の表示を追加。

UI: 週間予報テーブルに月齢アイコンと数値のカラムを追加。

Feature: 天体観測サマリーに月明かりの影響に関するコメントを追加。

[1.3.0] - 2026-01-02

Added

Feature: 天体観測予報機能を追加。指定日の夜間（20:00〜翌04:00）の平均雲量を分析し、観測適正をサマリーに表示。

Changed

Internal: サマリーテキストの表示をHTMLレンダリングに変更（太字や改行のサポート）。

[1.2.6] - 2026-01-02

Added

UI: 週間予報テーブルに「平均湿度」カラムを追加。

API: Open-Meteo APIのリクエストパラメータに relative_humidity_2m を追加。

[1.2.5] - 2026-01-02

Changed

Style: 下層雲（Low Clouds）のチャートおよびバーの色を明るいグレー (bg-gray-300) に変更し、中層雲とのコントラストを改善。

[1.2.4] - 2026-01-02

Changed

Style: 中層雲（Mid Clouds）のチャートおよびバーの色をエメラルドグリーン (bg-emerald-400) に変更し、視認性を向上。

[1.2.3] - 2026-01-02

Changed

Style: 雲量チャートとUIの配色テーマを変更。

上層雲: Violet

中層雲: Sky (※1.2.4でEmeraldに変更)

下層雲: Slate (※1.2.5でGrayに変更)

[1.2.2] - 2026-01-02

Changed

Chart: 雲量積み上げグラフ（Stacked Area Chart）の描画順序を変更。

変更前: 上層(底) -> 中層 -> 下層(上)

変更後: 下層(底) -> 中層 -> 上層(上)

これにより、実際の空の重なりと同じ視覚表現を実現。

[1.2.1] - 2026-01-02

Added

UI: 週間予報テーブルに「平均雲量」カラムを追加。

[1.2.0] - 2026-01-02

Added

Feature: Geolocation APIによる現在地取得機能。

Feature: Leaflet.jsを用いたインタラクティブな地図表示と場所選択機能。

Feature: OpenStreetMap Nominatim APIを用いた逆ジオコーディング（座標から住所名称の取得）。

UI: ヘッダーにバージョン番号と更新日を追加。

UI: フッターにデータ提供元（Open-Meteo, OpenStreetMap）へのクレジットを追加。

[1.1.0] - 2026-01-02

Added

Feature: 日時指定機能（Date Picker）。過去および未来の特定日時の天気データ表示に対応。

UI: 週間天気予報テーブル（天気アイコン、気温、降水確率）。

Internal: APIパラメータに past_days=2, forecast_days=10 を追加。

Changed

Localization: UIおよび日付表示を日本語化（Moment.js locale設定）。

Chart: 雲量チャートを折れ線グラフから積み上げ面グラフ（Stacked Area Chart）に変更。

[1.0.0] - 2026-01-02

Released

Initial Release: 三島市特化型天気ダッシュボード。

Features:

現在の気温、全天雲量の表示。

雲の層別（上層・中層・下層）詳細表示。

48時間気温推移チャート。

48時間雲量推移チャート。

# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [2.10.0] - 2026-01-16

### Added
- 大気透明度・シーイング指標機能を追加
    - 湿度、視程、風速、気圧安定度から天体観測条件を推定
    - 透明度スコア（星雲・星団観測向け）とシーイングスコア（惑星観測向け）を表示
    - 観測目的別のアドバイスを提供
    - 気圧の3時間変化から大気安定度を評価

## [2.9.4] - 2026-01-16

### Improved
- ISS現在位置表示モードの星座図でISSの位置をリアルタイム更新（5秒ごと）
- パス予測表示モードでは固定時刻のまま（変更なし）
- 「現在位置に戻る」ボタンでリアルタイム更新を再開

## [2.9.1] - 2026-01-16

### Changed
- ISSのTLE（2行軌道要素形式）の取得頻度を1日1回に制限
    - localStorageを使用してTLEデータと取得日時をキャッシュ
    - キャッシュが24時間以内の場合は再利用し、不要なAPIリクエストを削減

## [2.9.0] - 2026-01-16

### Improved
- 天体観測予報のレイアウトを改善
    - 時間帯別の予報を横並びのカード形式に変更
    - 記号（◎○△✕）を視認性スコアと同様のアイコン（⭐✨🌤️☁️）に変更

## [2.8.1] - 2026-01-16

### Added
- 星座図に太陽を表示するように変更
- 高度0度以上の時に太陽がオレンジ色のマーカーでプロットされるように改善

## [2.8.0] - 2026-01-16

### Improved
- ISS星座図の計算に使用する時刻の最適化
    - 現在位置を表示する場合は実時間（リアルタイム）を使用
    - 予測パスを表示する場合はそのパスの最大高度時刻を使用
    - これにより、ISSの位置に合わせて月や惑星の位置も正確に表示されるように改善

## [2.7.0] - 2026-01-15

### Added
- ISSの次回パス予測機能を追加（7日間）
- 次回可視時刻・最大仰角・距離を一覧表示
- パスの品質を4段階評価（最適/良好/可/低）
- 星座図に選択したパスの軌道を青い点線で表示
- 軌道上の5分刻みマーカーと時刻ラベル表示
- パス詳細情報パネル（開始・終了時刻、最大仰角、継続時間、距離）
- 「現在位置に戻る」ボタンで軌道表示をクリア

### Improved
- ISS星座図機能を拡張し、過去・現在・未来のISSパスを可視化
- 最大仰角10度以上のパスのみを表示（観測可能性を考慮）

## [2.6.3] - 2026-01-15

### Fixed
- ISS星座図でastronomy-engineが恒星をサポートしていないため発生するエラーを修正
- 恒星の表示を削除し、月と惑星のみを表示するように変更

### Changed
- 恒星の代わりに月を追加表示
- エラーメッセージをより詳細に表示（エラー内容を画面に表示）

## [2.6.2] - 2026-01-15

### Fixed
- ISS星座図描画時に「エラーが発生しました」と表示される問題を修正
- satellite.jsのAPI呼び出しを正しい形式に修正
- observerGdの定義をlongitudeを先にする形式に統一
- satellite.degreesToRadians()、satellite.radiansToDegrees()などの専用関数を使用

## [2.6.1] - 2026-01-15

### Fixed
- ISS星座図表示時に「ISS情報が取得できていません」と表示される問題を修正
- issTLE変数をwindow.currentTLEにも保存するように修正

## [2.6.0] - 2026-01-15

### Changed
- ISS星座図を地平座標系（方位角・高度）で表示するように変更
- 観測地点から実際に見える空の様子を表示（赤経・赤緯から変更）
- ISSが視野内（高度>0°）にある場合のみISSを表示
- ISSが地平線下の場合でも恒星と惑星は表示
- 高度>0°の恒星と惑星のみを表示（地平線下は非表示）

### Improved
- グリッド線を方位角（北・東・南・西）と高度（15°刻み）に変更
- 地平線（高度0°）を太線で強調表示
- ISSの視野内/視野外を情報パネルで明確に表示
- より直感的で実用的な星座図に改善

## [2.5.0] - 2026-01-15

### Added
- ISS星座図（天球図）表示機能をポップアップで追加
- ISSの赤経・赤緯座標を高精度計算
- 主要な恒星16個と惑星5個を星座図に表示
- Canvasによる美麗な天球座標グラフ描画
- 赤経・赤緯のグリッド線表示（天の赤道を強調）
- ISSパネルに「星座図を表示」ボタンを追加

### Improved
- ECI座標系から赤経・赤緯を正確に計算
- astronomy-engineで恒星と惑星の座標を計算
- リアルタイムでISSの天球上の位置を視覚化

## [2.4.0] - 2026-01-15

### Added
- 天の川視認性予測機能を追加
- 銀河中心（いて座A*）の位置計算（高度・方位）
- 月明かりの影響評価（月齢・月の高度・銀河中心との角距離）
- 雲量を考慮した総合視認性スコア（0-100点）
- 5段階評価（絶好/良好/やや不良/不良/視認不可）
- 天の川撮影に適した露出設定のアドバイス表示

### Improved
- astronomy-engineライブラリを活用した高精度な銀河中心位置計算
- 球面三角法による月と銀河中心の角距離計算
- 観測条件に応じた具体的な撮影アドバイスを提供

## [2.3.9] - 2026-01-15

### Added
- 天体イベント情報に「天文イベント（月食・日食）」パネルを追加
- 前後180日間の月食・日食を自動検索して表示
- イベントの種類（皆既・部分・半影月食、皆既・金環・部分日食）を表示
- イベントまでの日数を表示（今日/○日後/○日前）
- 30日以内のイベントには「近日開催」マークを表示

### Improved
- astronomy-engineライブラリを活用した高精度な天文イベント計算
- 過去のイベントは薄い色で表示し、未来のイベントを強調

## [2.3.8] - 2026-01-15

### Changed
- 雲量推移グラフを積み重ねグラフから個別線グラフに変更
- 各層（下層・中層・上層）の雲量を独立した線として表示
- Y軸の最大値を100%に固定し、パーセント表示を追加

### Fixed
- 雲量の積み重ねにより100%を超えてしまう問題を解決
- 各層の雲量を正確に把握できるように改善

## [2.3.7] - 2026-01-15

### Changed
- 「当日の夜」の定義を統一：当日の日没から翌日の日の出まで
- 星空視認性スコアを日没～日の出の期間で計算（天文薄明基準から変更）
- 天体観測予報も日没～日の出の期間で評価
- レーダーチャートの雲晴れ度も日没～日の出の期間を反映

### Improved
- より一般的な「夜」の定義に合わせることで、わかりやすく統一的な評価を実現
- 日没直後から日の出直前まで、夜間全体を通した評価を提供

## [2.3.6] - 2026-01-15

### Added
- ISS視認可能範囲内の表示機能を追加
- 仰角0度以上（地平線上）の場合に「視認可能範囲内」と表示
- 観測条件に応じて2段階の表示（最適条件/視認可能範囲内）

### Changed
- ISS可視予報の表示を改善し、視認可能範囲と最適観測条件を区別
- 仰角が低い場合や日中の場合に注意メッセージを表示

### Improved
- ISSの現在位置から観測地点への視認可能性をより明確に表示
- 地平線上にある場合は必ず視認可能範囲内として表示

## [2.3.5] - 2026-01-15

### Changed
- 観測期間を日没～日の出から、天文薄明終了～天文薄明開始に変更
- 星空視認性スコアを天文薄明終了から天文薄明開始までの平均雲量で計算
- 天体観測予報の時間帯別評価も天文薄明基準に変更

### Fixed
- 日没直後（まだ空が明るい時間帯）が観測期間に含まれていた問題を修正
- 時間帯別雲量と星空視認性スコアの不一致問題を改善

### Added
- デバッグログ機能を追加（開発者ツールのコンソールで計算値を確認可能）

### Improved
- 実際の天体観測の実態（天文薄明終了後から本格的な観測が可能）に合わせた評価

## [2.3.4] - 2026-01-15

### Changed
- 観測期間を固定時間帯（20:00-04:00）から実際の日没～翌日の日の出までに変更
- 星空視認性スコアを日没から日の出までの平均雲量で計算するように改善
- レーダーチャートの雲晴れ度も実際の観測可能時間に基づいて表示
- 天体観測予報の時間帯別評価を、観測期間を4等分した動的な時間帯で表示
- 天体観測予報に観測期間（日没～日の出の時刻）を明示

### Improved
- 季節や緯度によって異なる観測可能時間に対応し、より実態に即した評価を実現
- 夏至（日没が遅く日の出が早い）と冬至（日没が早く日の出が遅い）で適切に評価が変化

## [2.3.3] - 2026-01-15

### Changed
- 天体観測予報の評価基準をより厳格化（絶好: 10%未満、良好: 25%未満、やや雲多: 50%未満、不向き: 50%以上）
- 天体観測予報に時間帯別の詳細評価を追加（20-22時、22-24時、0-2時、2-4時の4つの時間帯で雲量と評価を表示）
- 星空視認性スコアの計算を、指定時刻の雲量から夜間平均雲量（20:00-04:00）ベースに変更
- レーダーチャートの「雲晴れ度」も夜間平均雲量を使用するように変更

### Fixed
- 雲量推移グラフと天体観測評価が食い違う問題を解決
- 雲が多い状況でも「観測に適している」と高評価になっていた問題を修正
- 時間帯によって雲量が大きく変動する場合でも、実態に即した評価を表示

## [2.3.2] - 2026-01-15

### Fixed
- 天体観測予報で指定日時の翌日が表示される問題を修正
- 日の出入り・天文薄明の計算を指定日の0時0分基準に変更
- 夜の時刻（例：20:00）を指定した場合でも、正しく当日の日の出入り時刻を表示するように改善

## [2.3.1] - 2026-01-15

### Fixed
- 日時選択機能の時間変更ができない問題を修正
- datetime-local inputにstep="900"属性を追加し、15分刻みでの時間変更を可能に
- 日付と時刻の両方を確実に変更できるように改善

### Changed
- datetime-local inputにtitle属性を追加してユーザビリティを向上

## [2.3.0] - 2026-01-15

### Added
- TLEベースのISS追跡機能を実装（satellite.jsライブラリを使用）
- CelesTrakからリアルタイムでISSのTLEデータを自動取得
- ISS可視予報機能を追加（観測地点からの可視性を計算）
- 天体イベント情報セクションにアコーディオン表示を実装
- 4つのパネル（ISS、惑星、流星群、推奨天体）を個別に展開/折りたたみ可能に

### Changed
- 不安定なOpen Notify APIからTLEベースの計算方式に変更
- 天体イベント情報のレイアウトを縦積みアコーディオン形式に変更
- デフォルトで全パネルを折りたたみ状態にし、省スペース化を実現
- satellite.js v5.0.0をCDN経由で読み込み

## [2.2.1] - 2026-01-15

### Removed
- Open Notify API依存のISS現在位置機能を削除（API不安定のため）
- ISS乗員情報機能を削除（API不安定のため）

## [2.2.0] - 2026-01-15

### Added
- ISS現在位置表示機能（Open Notify API使用）
- リアルタイムISS位置情報（緯度・経度・タイムスタンプ）の表示

### Changed
- ISS通過予報からISS現在位置表示に機能を移行
- Open Notify API エンドポイントを /iss-pass.json から /iss-now.json に変更

## [2.1.0] - 2026-01-14

### Added
- ISS乗員情報表示機能（Open Notify API使用）
- 現在ISSに滞在中の宇宙飛行士の人数と名前をリアルタイム表示
- Open Notify API の /astros.json エンドポイントを統合

## [2.0.0] - 2026-01-14

### Added
- 星空視認性スコア機能（雲量・月明かり・湿度・視程・風速を総合評価）
- 追加気象データ（風速・風向・気圧・露点・視程）の表示
- 天文薄明・日月出没時刻表示機能
- 24時間観測適性タイムライン
- ナイトビジョンモード（赤色表示で暗順応を妨げない）
- お気に入り地点機能（最大5件登録可能）
- 観測適性レーダーチャート
- 天体イベント情報セクション（惑星・流星群・推奨天体）

### Changed
- UIを大幅に刷新し、天体観測に特化したダッシュボードに変更

## [1.5.3] - 2026-01-13

### Removed
- 月の出データを削除

### Changed
- バージョン番号を復元

## [1.5.1] - 日付不明

### Added
- 日時指定機能
- 週間予報クリック機能

## [1.0.0] - 日付不明

### Added
- 初回リリース
- 基本的な天気ダッシュボード機能
- 気温・雲量の表示
- 週間予報機能
